#!/usr/bin/env ruby
#  Phusion Passenger - https://www.phusionpassenger.com/
#  Copyright (c) 2013 Phusion
#
#  "Phusion Passenger" is a trademark of Hongli Lai & Ninh Bui.
#
#  See LICENSE file for license information.

require 'socket'

a, b = UNIXSocket.pair
pid = Process.spawn("./agents/PassengerWatchdog",
	"web_server_pid", $$.to_s,
	"passenger_root", Dir.pwd,
	"log_level", "3",
	"request_socket_password", "-",
	"request_socket_link", "/tmp/flying-passenger.sock",
	
	:in  => ['/dev/null', 'r'],
	:out => :out,
	:err => :err,
	3    => b,
	:close_others => true
)
b.close

begin
	sleep
rescue SignalException => e
	if e.signo == Signal.list["INT"] || e.signo == Signal.list["TERM"]
		c.write('c')
		Process.waitpid(pid)
	end
end
